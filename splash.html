<html>
    <head>
       <script>
           
       </script>
        
    </head>
<body>
        <h1>Cisco Meraki Captive Portal</h1>
        

        <p><label>Name:</label><input type="text" id="name" placeholder="Bob Smith" required=true /></p>
        <p><label>Email:</label><input type="email" id="email" placeholder="bob@server.com" required=true /></p>
        
        <form id="loginForm" action="#" method="get">
            <input type="hidden" id="user_continue_url"/>
            <input type="submit" id="login" value="Submit" onclick="login()"/>
        </form>
        
        <hr>
        <p><label>User Continue URL: </label><label id="userContinueURL"></label></p>
        <p><label>Client IP: </label><label id="clientIP"></label></p>
        <p><label>Client MAC: </label><label id="clientMAC"></label></p>
        <p><label>Access Point MAC: </label><label id="nodeMAC"></label></p>
     
    
    
    <script>
            
            // Parse paramaters
            var base_grant_url = decodeURIComponent(GetURLParameter("base_grant_url"));
            var user_continue_url = decodeURIComponent(GetURLParameter("user_continue_url"));
            var node_mac = GetURLParameter("node_mac");
            var client_ip = GetURLParameter("client_ip");
            var client_mac = GetURLParameter("client_mac");
            
            console.log("user_continue_url: "+user_continue_url);
            console.log("client_ip: "+client_ip);
            document.getElementById("userContinueURL").innerHTML = user_continue_url;
            document.getElementById("clientIP").innerHTML = client_ip;
            document.getElementById("clientMAC").innerHTML = client_mac;
            document.getElementById("nodeMAC").innerHTML = node_mac;

            
            // Helper function to parse URL
            function GetURLParameter(sParam)
            {
                var sPageURL = window.location.search.substring(1);
                var sURLVariables = sPageURL.split('&');
                for (var i = 0; i < sURLVariables.length; i++) 
                {
                    var sParameterName = sURLVariables[i].split('=');
                    if (sParameterName[0] == sParam) 
                    {
                        return sParameterName[1];
                    }
                }
            }
            
   
            function survey(){
                var name = document.getElementById("name").value;
                var email = document.getElementById("email").value;
                alert("Hello "+name +"\n"+"Thanks for providing your email: "+email);
                // send the data somewhere
            }
            
            function login(){
                // process survey
                survey();

                console.log("base_grant_url: "+base_grant_url);
                console.log("user_continue_url: "+user_continue_url);
                
                // Login to WiFi
                document.getElementById("user_continue_url").value = user_continue_url;
                document.getElementById("loginForm").action = base_grant_url;
                document.getElementById("loginForm").submit();
            }

        </script>
</body>        
</html>